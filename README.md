# 基于YOLOv5的口罩识别系统

- 本系统是个人的本科毕设，本人已经毕业两年了，开源此代码供参考
- 后端使用Flask、开发了一个web的深度学习检测口罩的系统，可以自己训练网络，以此实现对应的功能
- 直接运行app.py
- 当然，也可能我改过这个的网络架构，实际并不是很难，网上开源YOLO系列教程很多，难的是如何放到前端，我自己也是研究了一段时间，自己能把这个代码跑通也可以了，目的是可以提供一个自己跑通代码的经历，可以借鉴这些代码，不希望完全雷同~

## 项目说明
该项目基于YOLOv5目标检测模型，开发了一个用于口罩佩戴检测的Web应用系统。系统可以检测人脸并识别是否正确佩戴口罩，支持图片和摄像头实时检测两种模式。

## 预训练模型
本项目使用YOLOv5-6.1版本的预训练模型，经过口罩数据集的微调。

### YOLOv5-6.1模型特性
- YOLOv5是当前最流行的目标检测模型之一，v6.1是其稳定的发行版本
- 相比于之前的版本，YOLOv5-6.1提供了更高的检测精度和更快的推理速度
- 模型包含多种尺寸变体（nano、small、medium、large、xlarge），可根据硬件条件选择合适的版本

### 获取预训练模型
1. **官方原始模型**：
   可以从官方GitHub仓库下载YOLOv5-6.1原始预训练模型：
   ```bash
   # 克隆YOLOv5官方仓库（如果需要）
   git clone https://github.com/ultralytics/yolov5
   cd yolov5
   
   # 下载预训练权重（以YOLOv5s为例）
   wget https://github.com/ultralytics/yolov5/releases/download/v6.1/yolov5s.pt
   ```

2. **口罩检测微调模型**：
   将预训练模型放入项目的`models`目录中。如果您需要适用于口罩检测的预训练模型，可以：
   - 使用项目中已有的模型（如果包含）
   - 使用提供的训练脚本对YOLOv5官方模型进行微调

### 模型结构
YOLOv5-6.1的核心组件包括：
- 主干网络(Backbone)：CSP-Darknet，用于特征提取
- 颈部网络(Neck)：PANet，用于特征融合
- 检测头(Head)：用于生成预测结果（目标类别、边界框和置信度）

### 在本项目中使用
- 项目默认使用YOLOv5s作为基础模型，针对口罩检测场景进行了优化
- 模型权重文件应放置在`models`目录下
- 可以通过修改`yolov5.py`中的参数来使用不同大小的模型变体

## 环境要求
- Python 3.8或更高版本
- PyTorch 1.8或更高版本
- Flask框架
- CUDA（推荐，用于GPU加速，不是必须）
- MySQL数据库（用于用户认证）
- 其他依赖包（详见requirements.txt）

## 安装与配置
1. 克隆项目到本地
   ```bash
   git clone https://github.com/Mrliujunwen/yolov5-with-flask.git
   cd yolov5-with-flask
   ```

2. 创建并激活虚拟环境（可选但推荐）
   ```bash
   python -m venv venv
   # Windows
   venv\Scripts\activate
   # Linux/Mac
   source venv/bin/activate
   ```

3. 安装依赖包
   ```bash
   pip install -r requirements.txt
   ```

4. 配置MySQL数据库
   - 安装MySQL数据库服务器
   - 创建名为`yz1`的数据库
   - 在数据库中创建`login`表，至少包含`id`、`name`和`password`字段
   - 默认的数据库连接配置如下（可在app.py中修改）：
     ```python
     host='127.0.0.1', user='root', passwd='root', port=3306, db='yz1', charset='utf8'
     ```

5. 下载预训练模型
   ```bash
   # 下载YOLOv5s v6.1模型
   wget https://github.com/ultralytics/yolov5/releases/download/v6.1/yolov5s.pt -O models/yolov5s.pt
   
   # 如果已经有针对口罩检测微调的模型，请将其放入models目录
   ```

## 运行过程

### 启动服务器
1. 确保MySQL数据库服务已启动

2. 在激活的虚拟环境中，运行以下命令启动Flask服务器：
   ```bash
   python app.py
   ```
   
3. 服务器默认会在本地5000端口运行。打开浏览器访问：
   ```
   http://127.0.0.1:5000
   ```

### 使用系统
系统提供以下功能：

1. **用户登录**
   - 在登录页面输入用户名和密码
   - 系统会验证用户身份并重定向到主页面

2. **图片检测模式**
   - 在网页界面上传一张包含人脸的图片
   - 点击"检测"按钮
   - 系统会返回处理后的图片，标记出人脸位置并显示是否佩戴口罩

3. **摄像头实时检测**
   - 点击"开启摄像头"按钮
   - 授权浏览器访问摄像头
   - 系统会实时检测摄像头画面中的人脸并标记口罩佩戴情况
   - 点击"关闭摄像头"停止检测

4. **视频检测模式**
   - 上传视频文件
   - 系统会处理视频并分析口罩佩戴情况
   - 可以下载或查看处理后的视频结果

5. **模型训练与管理**（如果支持）
   - 上传自定义数据集进行训练
   - 调整模型参数
   - 保存和加载不同的模型版本

## 数据库处理
系统使用MySQL数据库进行用户认证和会话管理：

1. **数据库结构**
   - 数据库名：`yz1`
   - 用户表：`login`（包含用户ID、用户名和密码字段）

2. **主要功能**
   - 用户登录验证
   - 会话管理（使用Flask的session机制）
   - 用户权限控制

3. **数据交互流程**
   - 用户提交登录表单
   - 系统验证用户名和密码
   - 验证成功后创建会话并保存用户ID
   - 后续请求使用会话ID验证用户身份

## 技术架构
- 前端：HTML/CSS/JavaScript
- 后端：Flask
- 深度学习框架：PyTorch
- 目标检测模型：YOLOv5
- 数据库：MySQL

## 常见问题排查
1. 如果出现依赖包安装错误，请确保使用了正确版本的Python和PyTorch
2. 检测性能不佳时，可以尝试调整models目录下的模型参数
3. 如果启动服务器时端口被占用，可以修改app.py中的端口设置
4. 数据库连接失败时，请检查MySQL服务是否启动以及连接配置是否正确

## 自定义开发
如需进一步开发和定制，可以修改以下部分：
- `app.py`：Flask应用主程序和路由设置
- `yolov5.py`：YOLOv5模型加载和推理逻辑
- `templates/`：前端HTML模板
- `static/`：静态资源（CSS、JavaScript和图片）
- `models/`：模型配置和权重文件
- 数据库结构：可以扩展用户表或添加新表以支持更多功能

## 许可证
本项目仅供学习和研究使用，请勿用于商业用途。

## 联系方式
如有问题或建议，请提交Issue或通过邮件联系。
